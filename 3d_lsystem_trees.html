<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3D L-Systems: Trees</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="3d_lsystem_trees_files/libs/clipboard/clipboard.min.js"></script>
<script src="3d_lsystem_trees_files/libs/quarto-html/quarto.js"></script>
<script src="3d_lsystem_trees_files/libs/quarto-html/popper.min.js"></script>
<script src="3d_lsystem_trees_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="3d_lsystem_trees_files/libs/quarto-html/anchor.min.js"></script>
<link href="3d_lsystem_trees_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="3d_lsystem_trees_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="3d_lsystem_trees_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="3d_lsystem_trees_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="3d_lsystem_trees_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="3d_lsystem_trees_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="3d_lsystem_trees_files/libs/rglWebGL-binding-1.2.8/rglWebGL.js"></script>
<link href="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/rgl.css" rel="stylesheet">
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/rglClass.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/utils.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/buffer.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/subscenes.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/shaders.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/shadersrc.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/textures.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/projection.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/mouse.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/init.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/pieces.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/draw.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/controls.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/selection.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/rglTimer.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/pretty.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/axes.src.js"></script>
<script src="3d_lsystem_trees_files/libs/rglwidgetClass-1.2.8/animation.src.js"></script>
<script src="3d_lsystem_trees_files/libs/CanvasMatrix4-1.2.8/CanvasMatrix.src.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">3D L-Systems: Trees</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="d-l-system" class="level2">
<h2 class="anchored" data-anchor-id="d-l-system">3D L-System</h2>
<p>In this project I’ll explore how to do a three dimensional implementation of the Lindenmayer system. The core of this is from the <a href="http://algorithmicbotany.org/papers/abop/abop.pdf">Algorithmic Beauty of Plants</a> (abbreviated ABOP), though I found myself wishing that I had access to the paper mentioned by <a href="https://www.sciencedirect.com/science/article/abs/pii/0022519371901913?via%3Dihub">Honda</a> as there were some points that were unclear, particularly the incorporation of tropism.<br>
This implementation requires two new items compared to prior systems: the ability to work in three dimensions and the ability to accept parameters.</p>
<section id="how-to-work-in-3d" class="level3">
<h3 class="anchored" data-anchor-id="how-to-work-in-3d">How to work in 3D</h3>
<p>In the former implementation of L-systems, points were generated by changing the position of a “turtle” and storing the x-position, y-position, and angle <span class="math inline">\((x,y,\alpha)\)</span>. For 3D, not only is the turtle’s position <span class="math inline">\((x,y,z)\)</span> needed but also it’s current orientation in space. In ABOP, this is done with three unit vectors <span class="math inline">\(\vec{H}, \vec{L}, \vec{U}\)</span> indicating the turtle’s heading, left, and up directions. These vectors are mutually orthogonal: <span class="math inline">\(\vec{H} \times \vec{L} = \vec{U}\)</span>. Rotations of the turtle can then be expressed as:</p>
<p><span class="math display">\[
[\vec{H}' \vec{L}' \vec{U}'] = [\vec{H} \vec{L} \vec{U}] \mathbf{R}
\]</span></p>
<p>Where <span class="math inline">\(\mathbf{R}\)</span> is a 3x3 rotation matrix. I used 4 rotation matrices in this writeup: the three from APOB to rotate around <span class="math inline">\(\vec{H}, \vec{L}\)</span>, and <span class="math inline">\(\vec{U}\)</span></p>
<span class="math display">\[\begin{aligned}
\mathbf{R_U}(\alpha) &amp;= \begin{bmatrix}
\cos{\alpha} &amp; \sin{\alpha} &amp; 0 \\
-\sin{\alpha} &amp; \cos{\alpha} &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix} \\

\mathbf{R_L}(\alpha) &amp;= \begin{bmatrix}
\cos{\alpha} &amp; 0 &amp; -\sin{\alpha} \\
0 &amp; 1 &amp; 0 \\
\sin{\alpha} &amp; 0 &amp; \cos{\alpha}
\end{bmatrix} \\

\mathbf{R_H}(\alpha) &amp;= \begin{bmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; \cos{\alpha} &amp; -\sin{\alpha} \\
0 &amp; \sin{\alpha} &amp; \cos{\alpha}
\end{bmatrix}
\end{aligned}\]</span>
<p>and one to rotate around an arbitrary axis <span class="math inline">\(\mathbf{n}\)</span> by <span class="math inline">\(\theta\)</span> from <a href="https://www.3dgep.com/3d-math-primer-for-game-programmers-matrices/#Rotation_about_an_arbitrary_axis">3D Game Engine Programming</a></p>
<span class="math display">\[\begin{bmatrix}
n_x^2(1-\cos{\theta})+\cos{\theta} &amp; n_xn_y(1-\cos{\theta})-n_z\sin{\theta} &amp; n_xn_z(1-\cos{\theta})+n_y\sin{\theta} \\
n_xn_y(1-\cos{\theta})+n_z\sin{\theta} &amp; n_y^2(1-\cos{\theta})+\cos{\theta} &amp; n_yn_z(1-\cos{\theta})-n_x\sin{\theta} \\
n_xn_z(1-\cos{\theta})-n_y\sin{\theta} &amp; n_yn_z(1-\cos{\theta})+n_x\sin{\theta} &amp; n_z^2(1-\cos{\theta})+\cos{\theta}
\end{bmatrix}\]</span>
</section>
<section id="exploring-3d-vectors" class="level3">
<h3 class="anchored" data-anchor-id="exploring-3d-vectors">Exploring 3d vectors</h3>
<p>Here I’ll illustrate how the 3D orientation vectors are transformed by rotation around different directions.</p>
<p>Note:</p>
<ul>
<li>H is in red = <span class="math inline">\([0,0,1]\)</span><br>
</li>
<li>L is in green = <span class="math inline">\([1,0,0]\)</span><br>
</li>
<li>U is in blue = <span class="math inline">\([0,1,0]\)</span><br>
</li>
<li><span class="math inline">\([HLU]\)</span> is bold, <span class="math inline">\([H'L'U']\)</span> is thin</li>
</ul>
<section id="rotate-30-degrees-around-heading" class="level4">
<h4 class="anchored" data-anchor-id="rotate-30-degrees-around-heading">Rotate 30 degrees around Heading</h4>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/explore3d_RH_ee05dc36d68e1eb641cf341db654c1ce">
<div class="cell-output-display no-overflow-x">
<div id="rgl36649" style="width:100%;height:464px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl36649-aria"></div>
<script type="application/json" data-for="rgl36649">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":7,"objects":{"14":{"id":14,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"0","flags":512},"15":{"id":15,"type":"points","material":{"lit":false},"vertices":"1","colors":"2","centers":"3","ignoreExtent":false,"flags":34816},"16":{"id":16,"type":"lines","material":{"lit":false},"vertices":"4","colors":"5","centers":"6","ignoreExtent":false,"flags":32832},"18":{"id":18,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"7","colors":"8","texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"9","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"19":{"id":19,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"10","colors":"11","texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"12","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"20":{"id":20,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"13","colors":"14","texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"15","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"21":{"id":21,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"16","colors":"17","centers":"18","ignoreExtent":false,"flags":41024},"22":{"id":22,"type":"text","material":{"lit":false},"vertices":"19","colors":"20","texts":[["H"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"21","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"23":{"id":23,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"22","colors":"23","centers":"24","ignoreExtent":false,"flags":41024},"24":{"id":24,"type":"text","material":{"lit":false},"vertices":"25","colors":"26","texts":[["L"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"27","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"25":{"id":25,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"28","colors":"29","centers":"30","ignoreExtent":false,"flags":41024},"26":{"id":26,"type":"text","material":{"lit":false},"vertices":"31","colors":"32","texts":[["U"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"33","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"28":{"id":28,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"34","flags":512},"29":{"id":29,"type":"points","material":{"lit":false},"vertices":"35","colors":"36","centers":"37","ignoreExtent":false,"flags":34816},"30":{"id":30,"type":"linestrip","material":{"lit":false},"vertices":"38","colors":"39","centers":"40","ignoreExtent":false,"flags":32832},"31":{"id":31,"type":"text","material":{"lit":false},"vertices":"41","colors":"42","texts":[["H'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"43","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"32":{"id":32,"type":"linestrip","material":{"lit":false},"vertices":"44","colors":"45","centers":"46","ignoreExtent":false,"flags":32832},"33":{"id":33,"type":"text","material":{"lit":false},"vertices":"47","colors":"48","texts":[["L'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"49","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"34":{"id":34,"type":"linestrip","material":{"lit":false},"vertices":"50","colors":"51","centers":"52","ignoreExtent":false,"flags":32832},"35":{"id":35,"type":"text","material":{"lit":false},"vertices":"53","colors":"54","texts":[["U'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"55","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"11":{"id":11,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"10":{"id":10,"type":"background","material":{},"colors":"56","centers":"57","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"12":{"id":12,"type":"background","material":{"lit":false,"back":"lines"},"colors":"58","centers":"59","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"17":{"id":17,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"60","colors":"61","axes":{"mode":["pretty","pretty","pretty"],"step":[0.5,0.5,0.5],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"13":{"id":13,"type":"subscene","par3d":{"antialias":8,"FOV":60,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,4.461292743682861],"modelMatrix":[[0.7071067690849304,0,-0.7071067690849304,-0.01767765171825886],[-0.3535533845424652,0.8660253882408142,-0.3535533845424652,-0.01281178835779428],[0.6123723983764648,0.5,0.6123723983764648,-4.489101886749268],[0,0,0,1]],"projMatrix":[[1.732050895690918,0,0,0],[0,1.732050895690918,0,0],[0,0,-1.999999761581421,-6.691938400268555],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[0.7071067690849304,0,-0.7071067690849304,0],[-0.3535533845424652,0.8660253882408142,-0.3535533845424652,0],[0.6123723983764648,0.5,0.6123723983764648,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NA","activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[14,15,11],"parent":7,"subscenes":[],"flags":35584},"27":{"id":27,"type":"subscene","par3d":{"antialias":8,"FOV":60,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,4.461292743682861],"modelMatrix":[[0.7071067690849304,0,-0.7071067690849304,-0.01767765171825886],[-0.3535533845424652,0.8660253882408142,-0.3535533845424652,-0.01281178835779428],[0.6123723983764648,0.5,0.6123723983764648,-4.489101886749268],[0,0,0,1]],"projMatrix":[[1.732050895690918,0,0,0],[0,1.732050895690918,0,0],[0,0,-1.999999761581421,-6.691938400268555],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[0.7071067690849304,0,-0.7071067690849304,0],[-0.3535533845424652,0.8660253882408142,-0.3535533845424652,0],[0.6123723983764648,0.5,0.6123723983764648,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NA","activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[28,29,11],"parent":7,"subscenes":[],"flags":35584},"7":{"id":7,"type":"subscene","par3d":{"antialias":8,"FOV":60,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,4.461292743682861],"modelMatrix":[[0.7071067690849304,0,-0.7071067690849304,-0.01767765171825886],[-0.3535533845424652,0.8660253882408142,-0.3535533845424652,-0.01281178835779428],[0.6123723983764648,0.5,0.6123723983764648,-4.489101886749268],[0,0,0,1]],"projMatrix":[[1.732050895690918,0,0,0],[0,1.732050895690918,0,0],[0,0,-1.999999761581421,-6.691938400268555],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[0.7071067690849304,0,-0.7071067690849304,0],[-0.3535533845424652,0.8660253882408142,-0.3535533845424652,0],[0.6123723983764648,0.5,0.6123723983764648,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-1,1.049999952316284,-1,1.049999952316284,-1,1],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NA","activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[12,17,16,18,19,20,21,22,23,24,25,26,30,31,32,33,34,35,11,13,27],"subscenes":[13,27],"flags":44881}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":4,"componentType":5120,"count":4,"type":"VEC3"},{"bufferView":5,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":6,"componentType":5120,"count":2,"type":"VEC3"},{"bufferView":7,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":8,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":9,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":10,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":11,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":12,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":13,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":14,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":15,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":16,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":17,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":18,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":19,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":20,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":21,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":22,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":23,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":24,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":25,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":26,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":27,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":28,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":29,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":30,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":31,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":32,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":33,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":34,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":35,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":36,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":37,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":38,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":39,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":40,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":41,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":42,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":43,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":44,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":45,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":46,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":47,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":48,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":49,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":50,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":51,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":52,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":53,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":54,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":55,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":56,"componentType":5126,"count":1,"type":"VEC4"},{"bufferView":57,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":58,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":59,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":60,"componentType":5126,"count":15,"type":"VEC3"},{"bufferView":61,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":18,"byteOffset":0},{"buffer":0,"byteLength":36,"byteOffset":20},{"buffer":0,"byteLength":4,"byteOffset":56},{"buffer":0,"byteLength":36,"byteOffset":60},{"buffer":0,"byteLength":12,"byteOffset":96},{"buffer":0,"byteLength":4,"byteOffset":108},{"buffer":0,"byteLength":6,"byteOffset":112},{"buffer":0,"byteLength":12,"byteOffset":120},{"buffer":0,"byteLength":4,"byteOffset":132},{"buffer":0,"byteLength":12,"byteOffset":136},{"buffer":0,"byteLength":12,"byteOffset":148},{"buffer":0,"byteLength":4,"byteOffset":160},{"buffer":0,"byteLength":12,"byteOffset":164},{"buffer":0,"byteLength":12,"byteOffset":176},{"buffer":0,"byteLength":4,"byteOffset":188},{"buffer":0,"byteLength":12,"byteOffset":192},{"buffer":0,"byteLength":6,"byteOffset":204},{"buffer":0,"byteLength":4,"byteOffset":210},{"buffer":0,"byteLength":6,"byteOffset":214},{"buffer":0,"byteLength":12,"byteOffset":220},{"buffer":0,"byteLength":4,"byteOffset":232},{"buffer":0,"byteLength":12,"byteOffset":236},{"buffer":0,"byteLength":6,"byteOffset":248},{"buffer":0,"byteLength":4,"byteOffset":254},{"buffer":0,"byteLength":6,"byteOffset":258},{"buffer":0,"byteLength":12,"byteOffset":264},{"buffer":0,"byteLength":4,"byteOffset":276},{"buffer":0,"byteLength":12,"byteOffset":280},{"buffer":0,"byteLength":6,"byteOffset":292},{"buffer":0,"byteLength":4,"byteOffset":298},{"buffer":0,"byteLength":6,"byteOffset":302},{"buffer":0,"byteLength":12,"byteOffset":308},{"buffer":0,"byteLength":4,"byteOffset":320},{"buffer":0,"byteLength":12,"byteOffset":324},{"buffer":0,"byteLength":18,"byteOffset":336},{"buffer":0,"byteLength":36,"byteOffset":356},{"buffer":0,"byteLength":4,"byteOffset":392},{"buffer":0,"byteLength":36,"byteOffset":396},{"buffer":0,"byteLength":6,"byteOffset":432},{"buffer":0,"byteLength":4,"byteOffset":438},{"buffer":0,"byteLength":6,"byteOffset":442},{"buffer":0,"byteLength":12,"byteOffset":448},{"buffer":0,"byteLength":4,"byteOffset":460},{"buffer":0,"byteLength":12,"byteOffset":464},{"buffer":0,"byteLength":24,"byteOffset":476},{"buffer":0,"byteLength":4,"byteOffset":500},{"buffer":0,"byteLength":24,"byteOffset":504},{"buffer":0,"byteLength":12,"byteOffset":528},{"buffer":0,"byteLength":4,"byteOffset":540},{"buffer":0,"byteLength":12,"byteOffset":544},{"buffer":0,"byteLength":24,"byteOffset":556},{"buffer":0,"byteLength":4,"byteOffset":580},{"buffer":0,"byteLength":24,"byteOffset":584},{"buffer":0,"byteLength":12,"byteOffset":608},{"buffer":0,"byteLength":4,"byteOffset":620},{"buffer":0,"byteLength":12,"byteOffset":624},{"buffer":0,"byteLength":16,"byteOffset":636},{"buffer":0,"byteLength":3,"byteOffset":652},{"buffer":0,"byteLength":4,"byteOffset":655},{"buffer":0,"byteLength":3,"byteOffset":659},{"buffer":0,"byteLength":180,"byteOffset":664},{"buffer":0,"byteLength":4,"byteOffset":844}],"buffers":[{"byteLength":848,"bytes":"AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAA\nwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/////////AQEBAQEB\nAAAAAf///wEBAQAAAADAfwAAgEAAAIA/AAAAAQAAwH8AAIBAAACAPwAAwH8AAIBAAACAPwAA\nAAEAAMB/AACAQAAAgD8AAMB/AACAQAAAgD8AAAABAADAfwAAgEAAAIA/AAAAAAABAQAAAQAA\nAAAAAc3MTD3NzEw9AACAPwAAAAHNzEw9zcxMPQAAgD8AAAABAAAAAQABAAAAAQAAZmaGP83M\nTD0AAAAAAAAAAWZmhj/NzEw9AAAAAAAAAAABAAAAAQEAAAAAAQDNzEw9ZmaGPwAAAAAAAAAB\nzcxMPWZmhj8AAAAAAQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAA\nwH8AAAAAAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/\nAAAAAAABAQAAAQAAAAAAAc3MTD3NzEw9AACAPwAAAAHNzEw9zcxMPQAAgD8AAAAAAAAAAAAA\nAADXs10/AAAAPwAAAAAAAQABAAAAAAAAAAAAAAAA17NdPwAAAD8AAAAApIBqP83MDD8AAAAA\nAAAAAaSAaj/NzAw/AAAAAAAAAAAAAAAAAAAAAAAAAL/Xs10/AAAAAAAAAQEAAAAAAAAAAAAA\nAAAAAAC/17NdPwAAAABmZua+pIBqPwAAAAAAAAABZmbmvqSAaj8AAAAAmZiYPpmYmD6ZmJg+\nAACAPwAAAAEBAQEAAAAAAAAAgL8AAMB/AADAfwAAAL8AAMB/AADAfwAAAAAAAMB/AADAfwAA\nAD8AAMB/AADAfwAAgD8AAMB/AADAfwAAwH8AAIC/AADAfwAAwH8AAAC/AADAfwAAwH8AAAAA\nAADAfwAAwH8AAAA/AADAfwAAwH8AAIA/AADAfwAAwH8AAMB/AACAvwAAwH8AAMB/AAAAvwAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAPwAAwH8AAMB/AACAPwAAAAE="}]},"context":{"shiny":false,"rmarkdown":null},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz/vNormal.w), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i])\n        lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, textureColor.a);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*textureColor.a);\n#endif\n \n#endif\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rotate-30-degrees-around-left" class="level4">
<h4 class="anchored" data-anchor-id="rotate-30-degrees-around-left">Rotate 30 degrees around Left</h4>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/explore3d_RL_549bf63c5a311fdfb354377080fdef73">
<div class="cell-output-display no-overflow-x">
<div id="rgl43055" style="width:100%;height:464px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl43055-aria"></div>
<script type="application/json" data-for="rgl43055">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":7,"objects":{"14":{"id":14,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"0","flags":512},"15":{"id":15,"type":"points","material":{"lit":false},"vertices":"1","colors":"2","centers":"3","ignoreExtent":false,"flags":34816},"16":{"id":16,"type":"lines","material":{"lit":false},"vertices":"4","colors":"5","centers":"6","ignoreExtent":false,"flags":32832},"18":{"id":18,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"7","colors":"8","texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"9","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"19":{"id":19,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"10","colors":"11","texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"12","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"20":{"id":20,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"13","colors":"14","texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"15","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"21":{"id":21,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"16","colors":"17","centers":"18","ignoreExtent":false,"flags":41024},"22":{"id":22,"type":"text","material":{"lit":false},"vertices":"19","colors":"20","texts":[["H"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"21","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"23":{"id":23,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"22","colors":"23","centers":"24","ignoreExtent":false,"flags":41024},"24":{"id":24,"type":"text","material":{"lit":false},"vertices":"25","colors":"26","texts":[["L"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"27","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"25":{"id":25,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"28","colors":"29","centers":"30","ignoreExtent":false,"flags":41024},"26":{"id":26,"type":"text","material":{"lit":false},"vertices":"31","colors":"32","texts":[["U"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"33","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"28":{"id":28,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"34","flags":512},"29":{"id":29,"type":"points","material":{"lit":false},"vertices":"35","colors":"36","centers":"37","ignoreExtent":false,"flags":34816},"30":{"id":30,"type":"linestrip","material":{"lit":false},"vertices":"38","colors":"39","centers":"40","ignoreExtent":false,"flags":32832},"31":{"id":31,"type":"text","material":{"lit":false},"vertices":"41","colors":"42","texts":[["H'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"43","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"32":{"id":32,"type":"linestrip","material":{"lit":false},"vertices":"44","colors":"45","centers":"46","ignoreExtent":false,"flags":32832},"33":{"id":33,"type":"text","material":{"lit":false},"vertices":"47","colors":"48","texts":[["L'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"49","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"34":{"id":34,"type":"linestrip","material":{"lit":false},"vertices":"50","colors":"51","centers":"52","ignoreExtent":false,"flags":32832},"35":{"id":35,"type":"text","material":{"lit":false},"vertices":"53","colors":"54","texts":[["U'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"55","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"11":{"id":11,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"10":{"id":10,"type":"background","material":{},"colors":"56","centers":"57","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"12":{"id":12,"type":"background","material":{"lit":false,"back":"lines"},"colors":"58","centers":"59","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"17":{"id":17,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"60","colors":"61","axes":{"mode":["pretty","pretty","pretty"],"step":[0.5,0.5,0.5],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"13":{"id":13,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[14,15,11],"parent":7,"subscenes":[],"flags":35584},"27":{"id":27,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[28,29,11],"parent":7,"subscenes":[],"flags":35584},"7":{"id":7,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-1,1.049999952316284,-1,1.049999952316284,-1,1],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[12,17,16,18,19,20,21,22,23,24,25,26,30,31,32,33,34,35,11,13,27],"subscenes":[13,27],"flags":44881}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":4,"componentType":5120,"count":4,"type":"VEC3"},{"bufferView":5,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":6,"componentType":5120,"count":2,"type":"VEC3"},{"bufferView":7,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":8,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":9,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":10,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":11,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":12,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":13,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":14,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":15,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":16,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":17,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":18,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":19,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":20,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":21,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":22,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":23,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":24,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":25,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":26,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":27,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":28,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":29,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":30,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":31,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":32,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":33,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":34,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":35,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":36,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":37,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":38,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":39,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":40,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":41,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":42,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":43,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":44,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":45,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":46,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":47,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":48,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":49,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":50,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":51,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":52,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":53,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":54,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":55,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":56,"componentType":5126,"count":1,"type":"VEC4"},{"bufferView":57,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":58,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":59,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":60,"componentType":5126,"count":15,"type":"VEC3"},{"bufferView":61,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":18,"byteOffset":0},{"buffer":0,"byteLength":36,"byteOffset":20},{"buffer":0,"byteLength":4,"byteOffset":56},{"buffer":0,"byteLength":36,"byteOffset":60},{"buffer":0,"byteLength":12,"byteOffset":96},{"buffer":0,"byteLength":4,"byteOffset":108},{"buffer":0,"byteLength":6,"byteOffset":112},{"buffer":0,"byteLength":12,"byteOffset":120},{"buffer":0,"byteLength":4,"byteOffset":132},{"buffer":0,"byteLength":12,"byteOffset":136},{"buffer":0,"byteLength":12,"byteOffset":148},{"buffer":0,"byteLength":4,"byteOffset":160},{"buffer":0,"byteLength":12,"byteOffset":164},{"buffer":0,"byteLength":12,"byteOffset":176},{"buffer":0,"byteLength":4,"byteOffset":188},{"buffer":0,"byteLength":12,"byteOffset":192},{"buffer":0,"byteLength":6,"byteOffset":204},{"buffer":0,"byteLength":4,"byteOffset":210},{"buffer":0,"byteLength":6,"byteOffset":214},{"buffer":0,"byteLength":12,"byteOffset":220},{"buffer":0,"byteLength":4,"byteOffset":232},{"buffer":0,"byteLength":12,"byteOffset":236},{"buffer":0,"byteLength":6,"byteOffset":248},{"buffer":0,"byteLength":4,"byteOffset":254},{"buffer":0,"byteLength":6,"byteOffset":258},{"buffer":0,"byteLength":12,"byteOffset":264},{"buffer":0,"byteLength":4,"byteOffset":276},{"buffer":0,"byteLength":12,"byteOffset":280},{"buffer":0,"byteLength":6,"byteOffset":292},{"buffer":0,"byteLength":4,"byteOffset":298},{"buffer":0,"byteLength":6,"byteOffset":302},{"buffer":0,"byteLength":12,"byteOffset":308},{"buffer":0,"byteLength":4,"byteOffset":320},{"buffer":0,"byteLength":12,"byteOffset":324},{"buffer":0,"byteLength":18,"byteOffset":336},{"buffer":0,"byteLength":36,"byteOffset":356},{"buffer":0,"byteLength":4,"byteOffset":392},{"buffer":0,"byteLength":36,"byteOffset":396},{"buffer":0,"byteLength":24,"byteOffset":432},{"buffer":0,"byteLength":4,"byteOffset":456},{"buffer":0,"byteLength":24,"byteOffset":460},{"buffer":0,"byteLength":12,"byteOffset":484},{"buffer":0,"byteLength":4,"byteOffset":496},{"buffer":0,"byteLength":12,"byteOffset":500},{"buffer":0,"byteLength":6,"byteOffset":512},{"buffer":0,"byteLength":4,"byteOffset":518},{"buffer":0,"byteLength":6,"byteOffset":522},{"buffer":0,"byteLength":12,"byteOffset":528},{"buffer":0,"byteLength":4,"byteOffset":540},{"buffer":0,"byteLength":12,"byteOffset":544},{"buffer":0,"byteLength":24,"byteOffset":556},{"buffer":0,"byteLength":4,"byteOffset":580},{"buffer":0,"byteLength":24,"byteOffset":584},{"buffer":0,"byteLength":12,"byteOffset":608},{"buffer":0,"byteLength":4,"byteOffset":620},{"buffer":0,"byteLength":12,"byteOffset":624},{"buffer":0,"byteLength":16,"byteOffset":636},{"buffer":0,"byteLength":3,"byteOffset":652},{"buffer":0,"byteLength":4,"byteOffset":655},{"buffer":0,"byteLength":3,"byteOffset":659},{"buffer":0,"byteLength":180,"byteOffset":664},{"buffer":0,"byteLength":4,"byteOffset":844}],"buffers":[{"byteLength":848,"bytes":"AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAA\nwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/////////AQEBAQEB\nAAAAAf///wEBAQAAAADAfwAAgEAAAIA/AAAAAQAAwH8AAIBAAACAPwAAwH8AAIBAAACAPwAA\nAAEAAMB/AACAQAAAgD8AAMB/AACAQAAAgD8AAAABAADAfwAAgEAAAIA/AAAAAAABAQAAAQAA\nAAAAAc3MTD3NzEw9AACAPwAAAAHNzEw9zcxMPQAAgD8AAAABAAAAAQABAAAAAQAAZmaGP83M\nTD0AAAAAAAAAAWZmhj/NzEw9AAAAAAAAAAABAAAAAQEAAAAAAQDNzEw9ZmaGPwAAAAAAAAAB\nzcxMPWZmhj8AAAAAAQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAA\nwH8AAAAAAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/\nAAAAAAAAAAAAAAAAAAAAAAAAAD/Xs10/AQAAAQAAAAAAAAAAAAAAAAAAAAAAAAA/17NdP83M\nTD3NzAw/17NdPwAAAAHNzEw9zcwMP9ezXT8AAAABAAAAAQABAAAAAQAAZmaGP83MTD0AAAAA\nAAAAAWZmhj/NzEw9AAAAAAAAAAAAAAAAAAAAAAAAAADXs10/AAAAvwAAAQEAAAAAAAAAAAAA\nAAAAAAAA17NdPwAAAL/NzEw9pIBqPwAAAL8AAAABzcxMPaSAaj8AAAC/mZiYPpmYmD6ZmJg+\nAACAPwAAAAEBAQEAAAAAAAAAgL8AAMB/AADAfwAAAL8AAMB/AADAfwAAAAAAAMB/AADAfwAA\nAD8AAMB/AADAfwAAgD8AAMB/AADAfwAAwH8AAIC/AADAfwAAwH8AAAC/AADAfwAAwH8AAAAA\nAADAfwAAwH8AAAA/AADAfwAAwH8AAIA/AADAfwAAwH8AAMB/AACAvwAAwH8AAMB/AAAAvwAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAPwAAwH8AAMB/AACAPwAAAAE="}]},"context":{"shiny":false,"rmarkdown":null},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz/vNormal.w), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i])\n        lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, textureColor.a);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*textureColor.a);\n#endif\n \n#endif\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rotate-30-degrees-around-up" class="level4">
<h4 class="anchored" data-anchor-id="rotate-30-degrees-around-up">Rotate 30 degrees around Up</h4>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/explore3d_RU_4afa511057f0e13dbad0225147b03097">
<div class="cell-output-display no-overflow-x">
<div id="rgl51457" style="width:100%;height:464px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl51457-aria"></div>
<script type="application/json" data-for="rgl51457">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":7,"objects":{"14":{"id":14,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"0","flags":512},"15":{"id":15,"type":"points","material":{"lit":false},"vertices":"1","colors":"2","centers":"3","ignoreExtent":false,"flags":34816},"28":{"id":28,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"4","flags":512},"29":{"id":29,"type":"points","material":{"lit":false},"vertices":"5","colors":"6","centers":"7","ignoreExtent":false,"flags":34816},"43":{"id":43,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"8","flags":512},"44":{"id":44,"type":"points","material":{"lit":false},"vertices":"9","colors":"10","centers":"11","ignoreExtent":false,"flags":34816},"45":{"id":45,"type":"lines","material":{"lit":false},"vertices":"12","colors":"13","centers":"14","ignoreExtent":false,"flags":32832},"47":{"id":47,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"15","colors":"16","texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"17","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"48":{"id":48,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"18","colors":"19","texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"20","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"49":{"id":49,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"21","colors":"22","texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"23","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"50":{"id":50,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"24","colors":"25","centers":"26","ignoreExtent":false,"flags":41024},"51":{"id":51,"type":"text","material":{"lit":false},"vertices":"27","colors":"28","texts":[["H"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"29","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"52":{"id":52,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"30","colors":"31","centers":"32","ignoreExtent":false,"flags":41024},"53":{"id":53,"type":"text","material":{"lit":false},"vertices":"33","colors":"34","texts":[["L"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"35","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"54":{"id":54,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"36","colors":"37","centers":"38","ignoreExtent":false,"flags":41024},"55":{"id":55,"type":"text","material":{"lit":false},"vertices":"39","colors":"40","texts":[["U"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"41","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"57":{"id":57,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"42","flags":512},"58":{"id":58,"type":"points","material":{"lit":false},"vertices":"43","colors":"44","centers":"45","ignoreExtent":false,"flags":34816},"59":{"id":59,"type":"linestrip","material":{"lit":false},"vertices":"46","colors":"47","centers":"48","ignoreExtent":false,"flags":32832},"60":{"id":60,"type":"text","material":{"lit":false},"vertices":"49","colors":"50","texts":[["H'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"51","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"61":{"id":61,"type":"linestrip","material":{"lit":false},"vertices":"52","colors":"53","centers":"54","ignoreExtent":false,"flags":32832},"62":{"id":62,"type":"text","material":{"lit":false},"vertices":"55","colors":"56","texts":[["L'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"57","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"63":{"id":63,"type":"linestrip","material":{"lit":false},"vertices":"58","colors":"59","centers":"60","ignoreExtent":false,"flags":32832},"64":{"id":64,"type":"text","material":{"lit":false},"vertices":"61","colors":"62","texts":[["U'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"63","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"11":{"id":11,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"12":{"id":12,"type":"background","material":{"lit":false,"back":"lines"},"colors":"64","centers":"65","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"46":{"id":46,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"66","colors":"67","axes":{"mode":["pretty","pretty","pretty"],"step":[0.5,0.5,0.5],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"13":{"id":13,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[14,15,11],"parent":7,"subscenes":[],"flags":35584},"27":{"id":27,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[28,29,11],"parent":7,"subscenes":[],"flags":35584},"42":{"id":42,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[43,44,11],"parent":7,"subscenes":[],"flags":35584},"56":{"id":56,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[57,58,11],"parent":7,"subscenes":[],"flags":35584},"7":{"id":7,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-1,1.049999952316284,-1,1.049999952316284,-1,1],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[12,46,45,47,48,49,50,51,52,53,54,55,59,60,61,62,63,64,11,13,27,42,56],"subscenes":[13,27,42,56],"flags":44881}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":4,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":5,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":6,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":7,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":8,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":9,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":10,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":11,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":12,"componentType":5120,"count":4,"type":"VEC3"},{"bufferView":13,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":14,"componentType":5120,"count":2,"type":"VEC3"},{"bufferView":15,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":16,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":17,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":18,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":19,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":20,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":21,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":22,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":23,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":24,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":25,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":26,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":27,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":28,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":29,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":30,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":31,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":32,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":33,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":34,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":35,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":36,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":37,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":38,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":39,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":40,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":41,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":42,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":43,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":44,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":45,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":46,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":47,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":48,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":49,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":50,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":51,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":52,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":53,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":54,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":55,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":56,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":57,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":58,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":59,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":60,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":61,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":62,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":63,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":64,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":65,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":66,"componentType":5126,"count":15,"type":"VEC3"},{"bufferView":67,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":18,"byteOffset":0},{"buffer":0,"byteLength":36,"byteOffset":20},{"buffer":0,"byteLength":4,"byteOffset":56},{"buffer":0,"byteLength":36,"byteOffset":60},{"buffer":0,"byteLength":18,"byteOffset":96},{"buffer":0,"byteLength":36,"byteOffset":116},{"buffer":0,"byteLength":4,"byteOffset":152},{"buffer":0,"byteLength":36,"byteOffset":156},{"buffer":0,"byteLength":18,"byteOffset":192},{"buffer":0,"byteLength":36,"byteOffset":212},{"buffer":0,"byteLength":4,"byteOffset":248},{"buffer":0,"byteLength":36,"byteOffset":252},{"buffer":0,"byteLength":12,"byteOffset":288},{"buffer":0,"byteLength":4,"byteOffset":300},{"buffer":0,"byteLength":6,"byteOffset":304},{"buffer":0,"byteLength":12,"byteOffset":312},{"buffer":0,"byteLength":4,"byteOffset":324},{"buffer":0,"byteLength":12,"byteOffset":328},{"buffer":0,"byteLength":12,"byteOffset":340},{"buffer":0,"byteLength":4,"byteOffset":352},{"buffer":0,"byteLength":12,"byteOffset":356},{"buffer":0,"byteLength":12,"byteOffset":368},{"buffer":0,"byteLength":4,"byteOffset":380},{"buffer":0,"byteLength":12,"byteOffset":384},{"buffer":0,"byteLength":6,"byteOffset":396},{"buffer":0,"byteLength":4,"byteOffset":402},{"buffer":0,"byteLength":6,"byteOffset":406},{"buffer":0,"byteLength":12,"byteOffset":412},{"buffer":0,"byteLength":4,"byteOffset":424},{"buffer":0,"byteLength":12,"byteOffset":428},{"buffer":0,"byteLength":6,"byteOffset":440},{"buffer":0,"byteLength":4,"byteOffset":446},{"buffer":0,"byteLength":6,"byteOffset":450},{"buffer":0,"byteLength":12,"byteOffset":456},{"buffer":0,"byteLength":4,"byteOffset":468},{"buffer":0,"byteLength":12,"byteOffset":472},{"buffer":0,"byteLength":6,"byteOffset":484},{"buffer":0,"byteLength":4,"byteOffset":490},{"buffer":0,"byteLength":6,"byteOffset":494},{"buffer":0,"byteLength":12,"byteOffset":500},{"buffer":0,"byteLength":4,"byteOffset":512},{"buffer":0,"byteLength":12,"byteOffset":516},{"buffer":0,"byteLength":18,"byteOffset":528},{"buffer":0,"byteLength":36,"byteOffset":548},{"buffer":0,"byteLength":4,"byteOffset":584},{"buffer":0,"byteLength":36,"byteOffset":588},{"buffer":0,"byteLength":24,"byteOffset":624},{"buffer":0,"byteLength":4,"byteOffset":648},{"buffer":0,"byteLength":24,"byteOffset":652},{"buffer":0,"byteLength":12,"byteOffset":676},{"buffer":0,"byteLength":4,"byteOffset":688},{"buffer":0,"byteLength":12,"byteOffset":692},{"buffer":0,"byteLength":24,"byteOffset":704},{"buffer":0,"byteLength":4,"byteOffset":728},{"buffer":0,"byteLength":24,"byteOffset":732},{"buffer":0,"byteLength":12,"byteOffset":756},{"buffer":0,"byteLength":4,"byteOffset":768},{"buffer":0,"byteLength":12,"byteOffset":772},{"buffer":0,"byteLength":6,"byteOffset":784},{"buffer":0,"byteLength":4,"byteOffset":790},{"buffer":0,"byteLength":6,"byteOffset":794},{"buffer":0,"byteLength":12,"byteOffset":800},{"buffer":0,"byteLength":4,"byteOffset":812},{"buffer":0,"byteLength":12,"byteOffset":816},{"buffer":0,"byteLength":4,"byteOffset":828},{"buffer":0,"byteLength":3,"byteOffset":832},{"buffer":0,"byteLength":180,"byteOffset":836},{"buffer":0,"byteLength":4,"byteOffset":1016}],"buffers":[{"byteLength":1020,"bytes":"AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAA\nwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AQAA/wAAAAEAAP8A\nAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAA\nAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAA\nwH8AAMB/AAAAAAAAwH8AAMB/////////AQEBAQEBAAAAAf///wEBAQAAAADAfwAAgEAAAIA/\nAAAAAQAAwH8AAIBAAACAPwAAwH8AAIBAAACAPwAAAAEAAMB/AACAQAAAgD8AAMB/AACAQAAA\ngD8AAAABAADAfwAAgEAAAIA/AAAAAAABAQAAAQAAAAAAAc3MTD3NzEw9AACAPwAAAAHNzEw9\nzcxMPQAAgD8AAAABAAAAAQABAAAAAQAAZmaGP83MTD0AAAAAAAAAAWZmhj/NzEw9AAAAAAAA\nAAABAAAAAQEAAAAAAQDNzEw9ZmaGPwAAAAAAAAABzcxMPWZmhj8AAAAAAQAA/wAAAAEAAP8A\nAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAAAAAAAAAAAAAvwAAAADXs10/\nAQAAAQAAAAAAAAAAAAAAAAAAAL8AAAAA17NdP2Zm5r7NzEw917NdPwAAAAFmZua+zcxMPdez\nXT8AAAAAAAAAAAAAAADXs10/AAAAAAAAAD8AAQABAAAAAAAAAAAAAAAA17NdPwAAAAAAAAA/\npIBqP83MTD0AAAA/AAAAAaSAaj/NzEw9AAAAPwAAAAABAAAAAQEAAAAAAQDNzEw9ZmaGPwAA\nAAAAAAABzcxMPWZmhj8AAAAAAQEBAQAAAAAAAIC/AADAfwAAwH8AAAC/AADAfwAAwH8AAAAA\nAADAfwAAwH8AAAA/AADAfwAAwH8AAIA/AADAfwAAwH8AAMB/AACAvwAAwH8AAMB/AAAAvwAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAPwAAwH8AAMB/AACAPwAAwH8AAMB/AADAfwAAgL8AAMB/\nAADAfwAAAL8AAMB/AADAfwAAAAAAAMB/AADAfwAAAD8AAMB/AADAfwAAgD8AAAAB"}]},"context":{"shiny":false,"rmarkdown":null},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz/vNormal.w), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i])\n        lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, textureColor.a);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*textureColor.a);\n#endif\n \n#endif\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rotate-30-degrees-around-111" class="level4">
<h4 class="anchored" data-anchor-id="rotate-30-degrees-around-111">Rotate 30 degrees around [1,1,1]</h4>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/explore3d_RT_126c01dd21a83e9eadb6b168ef3c02c2">
<div class="cell-output-display no-overflow-x">
<div id="rgl22441" style="width:100%;height:464px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl22441-aria"></div>
<script type="application/json" data-for="rgl22441">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":7,"objects":{"14":{"id":14,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"0","flags":512},"15":{"id":15,"type":"points","material":{"lit":false},"vertices":"1","colors":"2","centers":"3","ignoreExtent":false,"flags":34816},"28":{"id":28,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"4","flags":512},"29":{"id":29,"type":"points","material":{"lit":false},"vertices":"5","colors":"6","centers":"7","ignoreExtent":false,"flags":34816},"43":{"id":43,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"8","flags":512},"44":{"id":44,"type":"points","material":{"lit":false},"vertices":"9","colors":"10","centers":"11","ignoreExtent":false,"flags":34816},"57":{"id":57,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"12","flags":512},"58":{"id":58,"type":"points","material":{"lit":false},"vertices":"13","colors":"14","centers":"15","ignoreExtent":false,"flags":34816},"72":{"id":72,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"16","flags":512},"73":{"id":73,"type":"points","material":{"lit":false},"vertices":"17","colors":"18","centers":"19","ignoreExtent":false,"flags":34816},"74":{"id":74,"type":"lines","material":{"lit":false},"vertices":"20","colors":"21","centers":"22","ignoreExtent":false,"flags":32832},"76":{"id":76,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"23","colors":"24","texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"25","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"77":{"id":77,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"26","colors":"27","texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"28","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"78":{"id":78,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"29","colors":"30","texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"31","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"79":{"id":79,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"32","colors":"33","centers":"34","ignoreExtent":false,"flags":41024},"80":{"id":80,"type":"text","material":{"lit":false},"vertices":"35","colors":"36","texts":[["H"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"37","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"81":{"id":81,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"38","colors":"39","centers":"40","ignoreExtent":false,"flags":41024},"82":{"id":82,"type":"text","material":{"lit":false},"vertices":"41","colors":"42","texts":[["L"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"43","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"83":{"id":83,"type":"linestrip","material":{"lit":false,"lwd":4},"vertices":"44","colors":"45","centers":"46","ignoreExtent":false,"flags":41024},"84":{"id":84,"type":"text","material":{"lit":false},"vertices":"47","colors":"48","texts":[["U"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"49","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"86":{"id":86,"type":"clipplanes","offsets":[[1],[1],[1],[1],[1],[1]],"normals":"50","flags":512},"87":{"id":87,"type":"points","material":{"lit":false},"vertices":"51","colors":"52","centers":"53","ignoreExtent":false,"flags":34816},"88":{"id":88,"type":"linestrip","material":{"lit":false},"vertices":"54","colors":"55","centers":"56","ignoreExtent":false,"flags":32832},"89":{"id":89,"type":"text","material":{"lit":false},"vertices":"57","colors":"58","texts":[["H'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"59","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"90":{"id":90,"type":"linestrip","material":{"lit":false},"vertices":"60","colors":"61","centers":"62","ignoreExtent":false,"flags":32832},"91":{"id":91,"type":"text","material":{"lit":false},"vertices":"63","colors":"64","texts":[["L'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"65","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"92":{"id":92,"type":"linestrip","material":{"lit":false},"vertices":"66","colors":"67","centers":"68","ignoreExtent":false,"flags":32832},"93":{"id":93,"type":"text","material":{"lit":false},"vertices":"69","colors":"70","texts":[["U'"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"71","family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":33808},"94":{"id":94,"type":"linestrip","material":{"lit":false},"vertices":"72","colors":"73","centers":"74","ignoreExtent":false,"flags":32832},"11":{"id":11,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"12":{"id":12,"type":"background","material":{"lit":false,"back":"lines"},"colors":"75","centers":"76","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"75":{"id":75,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"77","colors":"78","axes":{"mode":["pretty","pretty","pretty"],"step":[0.5,0.5,0.5],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"13":{"id":13,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[14,15,11],"parent":7,"subscenes":[],"flags":35584},"27":{"id":27,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[28,29,11],"parent":7,"subscenes":[],"flags":35584},"42":{"id":42,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[43,44,11],"parent":7,"subscenes":[],"flags":35584},"56":{"id":56,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[57,58,11],"parent":7,"subscenes":[],"flags":35584},"71":{"id":71,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[72,73,11],"parent":7,"subscenes":[],"flags":35584},"85":{"id":85,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[123,-123,123,-123,123,-123],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[86,87,11],"parent":7,"subscenes":[],"flags":35584},"7":{"id":7,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,8.618556022644043],"modelMatrix":[[1,0,0,-0.02499997615814209],[0,0.3420201539993286,0.9396926164627075,-0.008550495840609074],[0,-0.9396926164627075,0.3420201539993286,-8.595064163208008],[0,0,0,1]],"projMatrix":[[3.732050657272339,0,0,0],[0,3.732050657272339,0,0],[0,0,-3.863703489303589,-31.06889915466309],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-1,1.049999952316284,-1,1.049999952316284,-1,1],"windowRect":[138,161,394,417],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"TT Arial","maxClipPlanes":8,"glVersion":4.6,"activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[12,75,74,76,77,78,79,80,81,82,83,84,88,89,90,91,92,93,94,11,13,27,42,56,71,85],"subscenes":[13,27,42,56,71,85],"flags":44881}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":4,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":5,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":6,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":7,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":8,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":9,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":10,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":11,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":12,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":13,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":14,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":15,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":16,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":17,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":18,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":19,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":20,"componentType":5120,"count":4,"type":"VEC3"},{"bufferView":21,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":22,"componentType":5120,"count":2,"type":"VEC3"},{"bufferView":23,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":24,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":25,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":26,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":27,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":28,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":29,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":30,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":31,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":32,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":33,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":34,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":35,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":36,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":37,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":38,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":39,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":40,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":41,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":42,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":43,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":44,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":45,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":46,"componentType":5121,"count":2,"type":"VEC3"},{"bufferView":47,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":48,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":49,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":50,"componentType":5120,"count":6,"type":"VEC3"},{"bufferView":51,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":52,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":53,"componentType":5126,"count":3,"type":"VEC3"},{"bufferView":54,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":55,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":56,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":57,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":58,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":59,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":60,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":61,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":62,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":63,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":64,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":65,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":66,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":67,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":68,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":69,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":70,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":71,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":72,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":73,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":74,"componentType":5126,"count":2,"type":"VEC3"},{"bufferView":75,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":76,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":77,"componentType":5126,"count":15,"type":"VEC3"},{"bufferView":78,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":18,"byteOffset":0},{"buffer":0,"byteLength":36,"byteOffset":20},{"buffer":0,"byteLength":4,"byteOffset":56},{"buffer":0,"byteLength":36,"byteOffset":60},{"buffer":0,"byteLength":18,"byteOffset":96},{"buffer":0,"byteLength":36,"byteOffset":116},{"buffer":0,"byteLength":4,"byteOffset":152},{"buffer":0,"byteLength":36,"byteOffset":156},{"buffer":0,"byteLength":18,"byteOffset":192},{"buffer":0,"byteLength":36,"byteOffset":212},{"buffer":0,"byteLength":4,"byteOffset":248},{"buffer":0,"byteLength":36,"byteOffset":252},{"buffer":0,"byteLength":18,"byteOffset":288},{"buffer":0,"byteLength":36,"byteOffset":308},{"buffer":0,"byteLength":4,"byteOffset":344},{"buffer":0,"byteLength":36,"byteOffset":348},{"buffer":0,"byteLength":18,"byteOffset":384},{"buffer":0,"byteLength":36,"byteOffset":404},{"buffer":0,"byteLength":4,"byteOffset":440},{"buffer":0,"byteLength":36,"byteOffset":444},{"buffer":0,"byteLength":12,"byteOffset":480},{"buffer":0,"byteLength":4,"byteOffset":492},{"buffer":0,"byteLength":6,"byteOffset":496},{"buffer":0,"byteLength":12,"byteOffset":504},{"buffer":0,"byteLength":4,"byteOffset":516},{"buffer":0,"byteLength":12,"byteOffset":520},{"buffer":0,"byteLength":12,"byteOffset":532},{"buffer":0,"byteLength":4,"byteOffset":544},{"buffer":0,"byteLength":12,"byteOffset":548},{"buffer":0,"byteLength":12,"byteOffset":560},{"buffer":0,"byteLength":4,"byteOffset":572},{"buffer":0,"byteLength":12,"byteOffset":576},{"buffer":0,"byteLength":6,"byteOffset":588},{"buffer":0,"byteLength":4,"byteOffset":594},{"buffer":0,"byteLength":6,"byteOffset":598},{"buffer":0,"byteLength":12,"byteOffset":604},{"buffer":0,"byteLength":4,"byteOffset":616},{"buffer":0,"byteLength":12,"byteOffset":620},{"buffer":0,"byteLength":6,"byteOffset":632},{"buffer":0,"byteLength":4,"byteOffset":638},{"buffer":0,"byteLength":6,"byteOffset":642},{"buffer":0,"byteLength":12,"byteOffset":648},{"buffer":0,"byteLength":4,"byteOffset":660},{"buffer":0,"byteLength":12,"byteOffset":664},{"buffer":0,"byteLength":6,"byteOffset":676},{"buffer":0,"byteLength":4,"byteOffset":682},{"buffer":0,"byteLength":6,"byteOffset":686},{"buffer":0,"byteLength":12,"byteOffset":692},{"buffer":0,"byteLength":4,"byteOffset":704},{"buffer":0,"byteLength":12,"byteOffset":708},{"buffer":0,"byteLength":18,"byteOffset":720},{"buffer":0,"byteLength":36,"byteOffset":740},{"buffer":0,"byteLength":4,"byteOffset":776},{"buffer":0,"byteLength":36,"byteOffset":780},{"buffer":0,"byteLength":24,"byteOffset":816},{"buffer":0,"byteLength":4,"byteOffset":840},{"buffer":0,"byteLength":24,"byteOffset":844},{"buffer":0,"byteLength":12,"byteOffset":868},{"buffer":0,"byteLength":4,"byteOffset":880},{"buffer":0,"byteLength":12,"byteOffset":884},{"buffer":0,"byteLength":24,"byteOffset":896},{"buffer":0,"byteLength":4,"byteOffset":920},{"buffer":0,"byteLength":24,"byteOffset":924},{"buffer":0,"byteLength":12,"byteOffset":948},{"buffer":0,"byteLength":4,"byteOffset":960},{"buffer":0,"byteLength":12,"byteOffset":964},{"buffer":0,"byteLength":24,"byteOffset":976},{"buffer":0,"byteLength":4,"byteOffset":1000},{"buffer":0,"byteLength":24,"byteOffset":1004},{"buffer":0,"byteLength":12,"byteOffset":1028},{"buffer":0,"byteLength":4,"byteOffset":1040},{"buffer":0,"byteLength":12,"byteOffset":1044},{"buffer":0,"byteLength":24,"byteOffset":1056},{"buffer":0,"byteLength":4,"byteOffset":1080},{"buffer":0,"byteLength":24,"byteOffset":1084},{"buffer":0,"byteLength":4,"byteOffset":1108},{"buffer":0,"byteLength":3,"byteOffset":1112},{"buffer":0,"byteLength":180,"byteOffset":1116},{"buffer":0,"byteLength":4,"byteOffset":1296}],"buffers":[{"byteLength":1300,"bytes":"AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAA\nwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AQAA/wAAAAEAAP8A\nAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAA\nAADAfwAAwH8AAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAA\nwH8AAMB/AAAAAAAAwH8AAMB/AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAA\nAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAA\nwH8AAMB/AQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAAAADAfwAAwH8AAAAA\nAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/////////\nAQEBAQEBAAAAAf///wEBAQAAAADAfwAAgEAAAIA/AAAAAQAAwH8AAIBAAACAPwAAwH8AAIBA\nAACAPwAAAAEAAMB/AACAQAAAgD8AAMB/AACAQAAAgD8AAAABAADAfwAAgEAAAIA/AAAAAAAB\nAQAAAQAAAAAAAc3MTD3NzEw9AACAPwAAAAHNzEw9zcxMPQAAgD8AAAABAAAAAQABAAAAAQAA\nZmaGP83MTD0AAAAAAAAAAWZmhj/NzEw9AAAAAAAAAAABAAAAAQEAAAAAAQDNzEw9ZmaGPwAA\nAAAAAAABzcxMPWZmhj8AAAAAAQAA/wAAAAEAAP8AAAABAAD/AAAAAAAAAADAfwAAwH8AAAAA\nAADAfwAAwH8AAAAAAADAfwAAwH8AAAABAAAAAAAAwH8AAMB/AAAAAAAAwH8AAMB/AAAAAAAA\nwH8AAMB/AAAAAAAAAAAAAAAAKUwiP69nu74AAIA/AQAAAQAAAAAAAAAAAAAAAClMIj+vZ7u+\nAACAP/YYLz8VzqG+AACAPwAAAAH2GC8/Fc6hvgAAgD8AAAAAAAAAAAAAAAAAAIA/KUwiP69n\nu74AAQABAAAAAAAAAAAAAAAAAACAPylMIj+vZ7u+ZmaGP/YYLz+vZ7u+AAAAAWZmhj/2GC8/\nr2e7vgAAAAAAAAAAAAAAAK9nu74AAIA/KUwiPwAAAQEAAAAAAAAAAAAAAACvZ7u+AACAPylM\nIj8VzqG+ZmaGPylMIj8AAAABFc6hvmZmhj8pTCI/AAAAAAAAAAAAAAAAOs0TPzrNEz86zRM/\nAAAAAQAAAAAAAAAAAAAAADrNEz86zRM/Os0TPwEBAQEAAAAAAACAvwAAwH8AAMB/AAAAvwAA\nwH8AAMB/AAAAAAAAwH8AAMB/AAAAPwAAwH8AAMB/AACAPwAAwH8AAMB/AADAfwAAgL8AAMB/\nAADAfwAAAL8AAMB/AADAfwAAAAAAAMB/AADAfwAAAD8AAMB/AADAfwAAgD8AAMB/AADAfwAA\nwH8AAIC/AADAfwAAwH8AAAC/AADAfwAAwH8AAAAAAADAfwAAwH8AAAA/AADAfwAAwH8AAIA/\nAAAAAQ=="}]},"context":{"shiny":false,"rmarkdown":null},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz/vNormal.w), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i])\n        lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, textureColor.a);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*textureColor.a);\n#endif\n \n#endif\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="including-parameters" class="level3">
<h3 class="anchored" data-anchor-id="including-parameters">Including Parameters</h3>
<p>To overcome limitations of the original L-system implementation such as an inability to model changes over time, Lindenmayer proposed that a symbol should also have a parameter associated with it. This is accomplished by changing the alphabet a L-system uses to a series of “modules” consisting of letters with associated parameters. Additionally, a production rule can require a parameter pass a test to apply the rule. Borrowing from ABOP the example production:</p>
<p><span class="math inline">\(A(t): t&gt;5 \rightarrow B(t+1)CD(t\wedge0.5, t-2)\)</span></p>
<p>will match a module in the parametric word if:</p>
<ul>
<li>the letter in the module and the letter in the production predecessor are the same,<br>
</li>
<li>the number of actual parameters in the module is equal to the number of formal parameters in the production predecessor, and</li>
<li>the condition evaluates to true if the actual parameter values are substitute for the formal parameters in the production.</li>
</ul>
<p>If the above rule is applied to <span class="math inline">\(A(9)\)</span>, the letter matches, the number of parameters matches, and 9 passes the condition so the production rule will result in <span class="math inline">\(B(10)CD(3,7)\)</span>.</p>
</section>
<section id="turtle-interpretation-of-parametric-words" class="level3">
<h3 class="anchored" data-anchor-id="turtle-interpretation-of-parametric-words">Turtle interpretation of parametric words</h3>
<p>A basic set of parameters used in this implementation are:</p>
<ul>
<li><span class="math inline">\(F(a)\)</span>: move forward step length <span class="math inline">\(a\)</span>. Turtle position changes to <span class="math inline">\((x+a\vec{H}_x,y+a\vec{H}_y,z+a\vec{H}_z)\)</span> and a line is drawn from start to finish<br>
</li>
<li><span class="math inline">\(!(a)\)</span>: set trunk thickness to <span class="math inline">\(a\)</span><br>
</li>
<li><span class="math inline">\(\&amp;(a)\)</span>: rotate around <span class="math inline">\(\vec{L}\)</span> by angle <span class="math inline">\(a\)</span> degrees<br>
</li>
<li><span class="math inline">\(/(a)\)</span>: rotate around <span class="math inline">\(\vec{H}\)</span> by angle <span class="math inline">\(a\)</span> degrees</li>
<li><span class="math inline">\([]\)</span>: Push/pop turtle’s current state to stack.</li>
</ul>
</section>
<section id="tropism" class="level3">
<h3 class="anchored" data-anchor-id="tropism">Tropism</h3>
<p>The bending of a tree’s branches due to either an environmental effect such as wind or gravity is simulated by rotating the turtle’s direction a small amount in the direction of a <span class="math inline">\(tropism\)</span> vector <span class="math inline">\(\vec{T}\)</span> after drawing each segment. I found the explanation in ABOP to be either incomplete or misleading as I was unable to get the exact structures presented in the book but I got close on most cases.<br>
The orientation of the turtle is adjusted by <span class="math inline">\(\alpha\)</span> according the formula <span class="math inline">\(\alpha = e|\vec{H} \times \vec{T}|\)</span> where <span class="math inline">\(e\)</span> captures the tree’s susceptibility to bending. As ABOP does not show an example or equation of the application of this bending to the turtle’s orientation I chose to model it as <span class="math inline">\([H'L'U'] = R[HLU]\)</span> where <span class="math inline">\(R\)</span> is the rotation matrix about an arbitrary axis. The axis for the rotation matrix was chosen to be <span class="math inline">\(\vec{H} \times \vec{T}\)</span> and the rotation angle <span class="math inline">\(\alpha\)</span>.</p>
</section>
</section>
<section id="implementation-in-r" class="level2">
<h2 class="anchored" data-anchor-id="implementation-in-r">Implementation in R</h2>
<p>The following functions are setup to produce a tree from Figure 2.8 of ABOP that is produced by the following <code>axiom</code> <span class="math inline">\(\omega\)</span> and production rules <span class="math inline">\(p_1, p_2, p_3\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\omega: !(1)F(200)/(45)A \\
&amp;p_1: A: * \rightarrow !(v_r)F(50)[\&amp;(a)F(50)A]/(d_1) \\
&amp;  \hspace{40mm}[\&amp;(a)F(50)A]/(d2)[\&amp;(a)F(50)A]\\
&amp;p_2: F(l): * \rightarrow F(l * l_r) \\
&amp;p_3: !(w): * \rightarrow !(w*v_r)
\end{aligned}
\]</span></p>
<p>To implement a 3D parametric system in R, the task was broken down into creating several functions:</p>
<ol type="1">
<li>Vector manipulation functions<br>
</li>
<li>Rotation matrix functions</li>
<li>Apply single production rules to input function</li>
<li>Generate L-system by iterating over input <span class="math inline">\(n\)</span> times function</li>
<li>Take L-system sentence and convert to points for plotting function</li>
</ol>
<section id="vector-operations" class="level3">
<h3 class="anchored" data-anchor-id="vector-operations">Vector operations</h3>
<p>To perform vector operations in R, I chose to create two functions that handle the cross product <code>cross(x,y)</code>and the magnitude of a vector <code>norm_vec(x)</code>.</p>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/vector operations_1db37c5cd464cd39e944a82871881098">
<details>
<summary>Code: Vector operations</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross product</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>cross <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A version of this on statology.com includes ability </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to create a 3D vec from 2D that isn't needed here. </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">&lt;-</span> <span class="cf">function</span>(i) (i<span class="dv">-1</span>) <span class="sc">%%</span> <span class="dv">3</span><span class="sc">+</span><span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (x[<span class="fu">j</span>(i<span class="sc">+</span><span class="dv">1</span>)]<span class="sc">*</span>y[<span class="fu">j</span>(i<span class="sc">+</span><span class="dv">2</span>)] <span class="sc">-</span> x[<span class="fu">j</span>(i<span class="sc">+</span><span class="dv">2</span>)]<span class="sc">*</span>y[<span class="fu">j</span>(i<span class="sc">+</span><span class="dv">1</span>)])</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector norm</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>norm_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rotation-matrices" class="level3">
<h3 class="anchored" data-anchor-id="rotation-matrices">Rotation Matrices</h3>
<p>Along with creating functions for the cross product and norm of vectors, having functions that find the rotation matrices around <span class="math inline">\(\vec{H}, \vec{L}, \vec{U}\)</span> and an arbitrary axis is another time saving convenience. I created the functions <code>RH</code>, <code>RL</code>, and <code>RU</code> to rotate around the turtle orientation vectors and <code>RT</code> to rotate toward the tropism vector.</p>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/rotation matrices_fc48a48adc39927b9f136829b5856620">
<details>
<summary>Code: Rotation matrices</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "Up" vector rotation matrix, returns matrix</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>RU <span class="ot">&lt;-</span> <span class="cf">function</span>(a) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> a<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span> <span class="co"># convert degrees to radians</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">cos</span>(a), <span class="sc">-</span><span class="fu">sin</span>(a), <span class="dv">0</span>, <span class="fu">sin</span>(a), <span class="fu">cos</span>(a), <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># "Left" vector rotation matrix, returns matrix</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>RL <span class="ot">&lt;-</span> <span class="cf">function</span>(a) {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> a<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span> <span class="co"># convert degrees to radians</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">cos</span>(a), <span class="dv">0</span>, <span class="fu">sin</span>(a), <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="fu">sin</span>(a), <span class="dv">0</span>, <span class="fu">cos</span>(a)), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># "Heading" vector rotation matrix, returns matrix</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>RH <span class="ot">&lt;-</span> <span class="cf">function</span>(a) {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> a<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span> <span class="co"># convert degrees to radians</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">cos</span>(a), <span class="fu">sin</span>(a), <span class="dv">0</span>, <span class="sc">-</span><span class="fu">sin</span>(a), <span class="fu">cos</span>(a)), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate T0 toward tropism vector, returns rotated T0</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>RT <span class="ot">&lt;-</span> <span class="cf">function</span>(T0, <span class="at">tropism =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>), e){</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alpha = rotation amount, e*|HxT|</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> e<span class="sc">*</span><span class="fu">norm_vec</span>(<span class="fu">cross</span>(T0[,<span class="dv">1</span>], tropism)) </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Chose rotation axis to be |HxT|</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">cross</span>(T0[,<span class="dv">1</span>], tropism) <span class="co">#rotation axis</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="cf">if</span>(a <span class="sc">!=</span> <span class="dv">0</span>) { <span class="co"># normalize</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    r<span class="sc">/</span><span class="fu">norm_vec</span>(r)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    r</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rotation matrix - arbitrary axis</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  rot_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(r[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">+</span><span class="fu">cos</span>(a), </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">1</span>]<span class="sc">*</span>r[<span class="dv">2</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">+</span>r[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">sin</span>(a), </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">1</span>]<span class="sc">*</span>r[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">-</span>r[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">sin</span>(a), </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">1</span>]<span class="sc">*</span>r[<span class="dv">2</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">-</span>r[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">sin</span>(a),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">+</span><span class="fu">cos</span>(a), </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">2</span>]<span class="sc">*</span>r[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">+</span>r[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">sin</span>(a), </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">1</span>]<span class="sc">*</span>r[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">+</span>r[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">sin</span>(a), </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">2</span>]<span class="sc">*</span>r[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">-</span>r[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">sin</span>(a), </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                      r[<span class="dv">3</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cos</span>(a))<span class="sc">+</span><span class="fu">cos</span>(a)),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># does order of product matter? it sure does. This is how it's defined in the source: </span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://www.3dgep.com/3d-math-primer-for-game-programmers-matrices/#Rotation_about_an_arbitrary_axis</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  rot_mat <span class="sc">%*%</span> T0</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="axiom-and-production-rules" class="level3">
<h3 class="anchored" data-anchor-id="axiom-and-production-rules">Axiom and production rules</h3>
<p>To convert the above axiom and production rules into something R can interpret, I chose to store them as a list. The advantage the list has over a string is that it simplifies the use of parameters as a list can store for each letter one or more parameters that can be easily extracted, manipulated, and stored.<br>
So that different parameters can be passed to the production rules, I chose to make it a function that accepts the parameters that can be changed.</p>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/axiom and rules_4eb4b4822f2af1424670b5db590401a6">
<details>
<summary>Axiom and Rules</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tree axiom for figure 2.8 from ABOP</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>axiom <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"!"</span>, <span class="at">param =</span> <span class="dv">1</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"F"</span>, <span class="at">param =</span> <span class="dv">200</span>), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"/"</span>, <span class="at">param =</span> <span class="dv">45</span>), </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"A"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Rules, initial state 2.8a parameters</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d1 =</span> <span class="fl">94.74</span>, <span class="at">d2 =</span> <span class="fl">132.63</span>, <span class="at">a =</span> <span class="fl">18.95</span>, <span class="at">lr =</span> <span class="fl">1.109</span>, <span class="at">vr =</span> <span class="fl">1.732</span>) {<span class="fu">list</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">list</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"!"</span>, <span class="at">param =</span> vr), </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"F"</span>, <span class="at">param =</span> <span class="dv">50</span>), </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"["</span>), </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"&amp;"</span>, <span class="at">param =</span> a), </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"F"</span>, <span class="at">param =</span> <span class="dv">50</span>), </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"A"</span>), </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"]"</span>), </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"/"</span>, <span class="at">param =</span> d1), </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"["</span>),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"&amp;"</span>, <span class="at">param =</span> a), </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"F"</span>, <span class="at">param =</span> <span class="dv">50</span>), </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"A"</span>), </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"]"</span>), </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"/"</span>, <span class="at">param =</span> d2), </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"["</span>), </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"&amp;"</span>, <span class="at">param =</span> a), </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"F"</span>, <span class="at">param =</span> <span class="dv">50</span>), </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"A"</span>), </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"]"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">F =</span> <span class="fu">list</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"F"</span>, <span class="at">param =</span> lr)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"!"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">"!"</span>, <span class="at">param =</span> vr)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="apply-production-rule" class="level3">
<h3 class="anchored" data-anchor-id="apply-production-rule">Apply production rule</h3>
<p>In the prior implementation of L-systems, the rules were applied over a string. As this implementation requires a parameter to be associated with each letter, storing the system as a list was a natural route.<br>
The <code>apply_rules</code> function looks at a <code>symbol</code> that is a list with names <code>symbol</code> and <code>param</code> and compares it to a second list of <code>rules</code> that stores the production rules for each letter of the system. If the input <code>symbol</code> matches a name of a rule in <code>rules</code>, the corresponding rule is returned by the function. If no match is found, the input symbol is returned. Also in this function, if <code>F</code> or <code>!</code> was the input symbol, these require multiplying their input parameter by the rule parameter.</p>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/production rule_70683c158356edba23ed772e038bdd09">
<details>
<summary>Code: Apply production rule</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>apply_rules <span class="ot">&lt;-</span> <span class="cf">function</span>(symbol, rules) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (symbol<span class="sc">$</span>symbol <span class="sc">%in%</span> <span class="fu">names</span>(rules)) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    transformed_symbol <span class="ot">&lt;-</span> rules[[symbol<span class="sc">$</span>symbol]]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply parameter transformation if symbol is F or !</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(symbol<span class="sc">$</span>symbol <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"!"</span>)) {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># for (i in seq_along(transformed_symbol)) {</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change parameter value of old symbol by product with new parameter</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        transformed_symbol[[<span class="dv">1</span>]]<span class="sc">$</span>param <span class="ot">&lt;-</span> transformed_symbol[[<span class="dv">1</span>]]<span class="sc">$</span>param <span class="sc">*</span> symbol<span class="sc">$</span>param</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">#}</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(transformed_symbol)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(symbol))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="generate-l-system" class="level3">
<h3 class="anchored" data-anchor-id="generate-l-system">Generate L-System</h3>
<p>This function is finally the main generator of the 3D L-system. It takes in a list <code>axiom</code> - the starting point of the tree, a list of production <code>rules</code> to transform the axiom in each generation, and the number of <code>iterations</code> to run through. The function operates by running through each <code>symbol</code> in the current sequence and passing it to <code>apply_rules</code> building a new sequence. This is looped over <code>iterations</code> times on each newly generated sequence before the final sequence is returned.</p>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/Generate l-system_9fdb3fdaa06ebd42fdbe1f82a7cf4621">
<details>
<summary>Code: Generate L-System</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function to generate L-system using apply_rules</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>generate_l_system <span class="ot">&lt;-</span> <span class="cf">function</span>(axiom, rules, iterations) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  sequence <span class="ot">&lt;-</span> axiom</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iterations) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    new_sequence <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">0</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (symbol <span class="cf">in</span> sequence) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      transformed_symbol <span class="ot">&lt;-</span> <span class="fu">apply_rules</span>(symbol, rules)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      new_sequence <span class="ot">&lt;-</span> <span class="fu">c</span>(new_sequence, transformed_symbol)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    sequence <span class="ot">&lt;-</span> new_sequence</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sequence)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="convert-l-system-sentence-to-points" class="level3">
<h3 class="anchored" data-anchor-id="convert-l-system-sentence-to-points">Convert L-System sentence to points</h3>
<p>Finally, the output of <code>generate_l_system(axiom, rules, iterations)</code> must be converted to set of positions by interpreting each letter and parameter as a set of instructions to the turtle. This is accomplished in the same was as prior L-systems with the added wrinkle that now the sequence of instructions is saved as a list of symbols and parameters.<br>
The <code>draw_3d_lsystem</code> function takes the same arguments as <code>generate_l_system</code> in addition to a <code>tropism</code> vector and susceptibility to bending factor <code>e</code>. The function then:</p>
<ol type="1">
<li>Generates the l-system by calling <code>generate_l_system</code></li>
<li>Sets the turtle’s initial state<br>
</li>
<li>Initializes the branch <code>[]</code> push/pop list</li>
<li>Iterates over each individual action in the l-system
<ul>
<li>If <code>F</code>: move forward along heading vector by <code>param</code> value, then adjust heading toward tropism vector. Also, set <code>lwd</code> parameter</li>
<li>If <code>!</code>: update turtle’s <code>lwd</code> (branch thickness)</li>
<li>If <code>/</code>, rotate orientation by <code>RH(param)</code></li>
<li>If <code>&amp;</code>: rotate orientation by <code>RL(param)</code></li>
<li>If <code>[</code>: push current state to stack</li>
<li>If <code>]</code>: pop last state from stack and set to current</li>
<li>If <code>A</code>: do nothing, left over generation function</li>
</ul></li>
</ol>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/l-system to points_55efdc9c5fa42acf0f1bd478933bf04a">
<details>
<summary>L-system to Points</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>points_3d_lsystem <span class="ot">&lt;-</span> <span class="cf">function</span>(axiom, rules, iterations, <span class="at">tropism =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>), <span class="at">e =</span> .<span class="dv">14</span>) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the l_system instructions</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  tree <span class="ot">&lt;-</span> <span class="fu">generate_l_system</span>(axiom, rules, iterations)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Establish turtle initial state: heading along z, left on x, up on y</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  H0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>); L0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>); U0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  T0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(H0, L0, U0), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  x0 <span class="ot">&lt;-</span> <span class="dv">0</span>; y0 <span class="ot">&lt;-</span> <span class="dv">0</span>; z0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  lwd <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># turtle position, including seg to aid in plotting points later</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  turtle <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x0, <span class="at">y =</span> y0, <span class="at">z =</span> z0, <span class="at">lwd =</span> lwd, <span class="at">seg =</span> <span class="dv">0</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  branch_pop <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  pop_lvl <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (action <span class="cf">in</span> tree) {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(action<span class="sc">$</span>symbol <span class="sc">==</span> <span class="st">"F"</span>) {</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># move forward distance of param</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      lwd <span class="ot">&lt;-</span> turtle[<span class="fu">nrow</span>(turtle), <span class="st">"lwd"</span>]</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> turtle[<span class="fu">nrow</span>(turtle), <span class="st">"x"</span>] <span class="sc">+</span> action<span class="sc">$</span>param <span class="sc">*</span> T0[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> turtle[<span class="fu">nrow</span>(turtle), <span class="st">"y"</span>] <span class="sc">+</span> action<span class="sc">$</span>param <span class="sc">*</span> T0[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      z <span class="ot">&lt;-</span> turtle[<span class="fu">nrow</span>(turtle), <span class="st">"z"</span>] <span class="sc">+</span> action<span class="sc">$</span>param <span class="sc">*</span> T0[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      seg <span class="ot">&lt;-</span> turtle[<span class="fu">nrow</span>(turtle),<span class="st">"seg"</span>]</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      turtle <span class="ot">&lt;-</span> <span class="fu">rbind</span>(turtle, <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">z=</span>z, <span class="at">lwd=</span>lwd, <span class="at">seg =</span> seg<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># TROPISM - results not entirely consistent with book, mainly on plot d</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      T0 <span class="ot">&lt;-</span> <span class="fu">RT</span>(T0, tropism, e)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (action<span class="sc">$</span>symbol <span class="sc">==</span> <span class="st">"!"</span>) {</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># set lwd to param</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      lwd <span class="ot">&lt;-</span> action<span class="sc">$</span>param</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>      turtle[<span class="fu">nrow</span>(turtle), <span class="st">"lwd"</span>] <span class="ot">&lt;-</span> lwd</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (action<span class="sc">$</span>symbol <span class="sc">==</span> <span class="st">"/"</span>) {</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Roll right by angle param, using rotation matrix $R_H(param)$</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>      T0 <span class="ot">&lt;-</span> T0 <span class="sc">%*%</span> <span class="fu">RH</span>(action<span class="sc">$</span>param)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (action<span class="sc">$</span>symbol <span class="sc">==</span> <span class="st">"&amp;"</span>) {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Pitch down by angle param, using rotation matrix $R_L(param)$</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      T0 <span class="ot">&lt;-</span> T0 <span class="sc">%*%</span> <span class="fu">RL</span>(action<span class="sc">$</span>param)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (action<span class="sc">$</span>symbol <span class="sc">==</span> <span class="st">"["</span>) {</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>      <span class="co"># add current state to branch_pop</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>      pop_lvl <span class="ot">&lt;-</span> pop_lvl <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>      branch_pop <span class="ot">&lt;-</span> <span class="fu">c</span>(branch_pop, <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">pos =</span> turtle[<span class="fu">nrow</span>(turtle),], </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">T =</span> T0)))</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (action<span class="sc">$</span>symbol <span class="sc">==</span> <span class="st">"A"</span>) {</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Do nothing, consider removing A from list before creating turtle</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>      <span class="co"># set top stack value to current state</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>      turtle <span class="ot">&lt;-</span> <span class="fu">rbind</span>(turtle, </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#c(NA, NA, NA, NA), </span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                      branch_pop[[pop_lvl]]<span class="sc">$</span>pos)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>      T0 <span class="ot">&lt;-</span> branch_pop[[pop_lvl]]<span class="sc">$</span>T</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove last of stack. </span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>      branch_pop <span class="ot">&lt;-</span> branch_pop[<span class="sc">-</span><span class="fu">length</span>(branch_pop)]</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>      pop_lvl <span class="ot">&lt;-</span> pop_lvl <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  turtle</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="draw-l-system" class="level3">
<h3 class="anchored" data-anchor-id="draw-l-system">Draw L-System</h3>
<p>The final function required is one that takes a generated set of points and creates a plot of the structure. For this, I chose to use <code>rgl::plot3d</code> and associated functions. The primary limitation I found is that currently <code>plot3d</code> does not accept a vector of colors or line widths so I was unable to change the appearance of each branch segment without the use of a <code>for</code> loop. The function below:</p>
<ol type="1">
<li>Sets the color palette of the branches<br>
</li>
<li>Selects an appropriate number of colors depending on the max length of a branch and adds green for the last color to evoke leaves<br>
</li>
<li>Opens a new rgl device<br>
</li>
<li>Sets the window size and viewing angle so different trees are consistent<br>
</li>
<li>Iterates over each branch of the tree drawing a line segment with <code>lines3d</code>, the <code>lwd</code> of the section’s end point, and a color.</li>
</ol>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/unnamed-chunk-1_55ec93b8be9560305c4f0e46f54488f3">
<details>
<summary>Create Graph</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>draw_3d_lsystem <span class="ot">&lt;-</span> <span class="cf">function</span>(tree) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># colors for branches, gradient of brown</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  yb<span class="ot">&lt;-</span><span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#1B0000"</span>,<span class="st">"#4d2B0b"</span>,<span class="st">"chocolate4"</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Color each segment, make last green </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">yb</span>(<span class="fu">max</span>(tree<span class="sc">$</span>seg)<span class="sc">-</span><span class="dv">1</span>),<span class="st">"green4"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot!</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">open3d</span>(<span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par3d</span>(<span class="at">windowRect =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">600</span>)) <span class="co"># consistent window size</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">view3d</span>(<span class="at">theta =</span> <span class="dv">0</span>, <span class="at">phi =</span> <span class="sc">-</span><span class="dv">75</span>, <span class="at">zoom =</span> .<span class="dv">6</span>) <span class="co"># consistent window view</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot3d</span>(tree, <span class="at">type =</span> <span class="st">"n"</span>) <span class="co"># blank window for xyz extents</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(tree)<span class="sc">-</span><span class="dv">1</span>)) { <span class="co"># add each branch</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(tree[i,<span class="st">"seg"</span>] <span class="sc">&lt;</span> tree[i<span class="sc">+</span><span class="dv">1</span>,<span class="st">"seg"</span>]) {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines3d</span>(tree[i<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">1</span>),], <span class="at">lwd =</span> tree[i<span class="sc">+</span><span class="dv">1</span>,]<span class="sc">$</span>lwd<span class="sc">/</span><span class="fl">1.73</span>, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> cols[tree[i,<span class="st">"seg"</span>]<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>Trying to include the tree as an interactive plot similar to the vector visualizations above caused the website to slow to the point of unusability. As an alternative, using <code>rgl::movie3d</code> a gif was created to highlight the resulting tree structure.</p>
<div class="cell" data-hash="3d_lsystem_trees_cache/html/Treea_9e9964ce94d07fd6d21d93c541155049">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>treea <span class="ot">&lt;-</span> <span class="fu">points_3d_lsystem</span>(axiom, <span class="fu">rules</span>(), <span class="dv">6</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">draw_3d_lsystem</span>(treea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tree_figa_loop.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Treea</figcaption>
</figure>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>